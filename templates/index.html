<!-- This is the home page. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="import" href="/static/common.html">

    <script>
    $(document).ready(function(){
        SetUpNavBar(SetUpFirebase);
    });
    </script>

  <script type="text/javascript">
      function displayFilterCostumeForm() {
        document.getElementById("costume_specific_forms").style.display = 'block'
      }

      function hideFilterCostumeForm() {
        document.getElementById("costume_specific_forms").style.display = 'none'
      }

      function setCheckedRadioValues(radioListName, valueChecked) {
          var radioList = document.getElementsByName(radioListName);
          for (var i = 0; i < radioList.length; i++) {
                if (document.getElementById(radioList[i].id) != null) {
                    document.getElementById(radioList[i].id).checked = false;
                }
          }
          if (document.getElementById(valueChecked) != null) {
              document.getElementById(valueChecked).checked = true;
          }
      }

      function setCheckboxValues(x) {
        if (typeof(Storage) !== "undefined") {
            var conditionArray = new Array();
            var articleArray = new Array();
            var costumeSizeStringArray = new Array();
            var costumeSizeNumArray = new Array();
            var tagGrouping = "groupingInclusive";
            var itemType = "All";
            var nameText = document.getElementById("nameBox").value;
            var tagText = document.getElementById("tagBox").value;
            var conditionList = x.filter_by_condition;
            var articleList = x.filter_by_article;
            var costumeSizeStringList = x.filter_by_costume_size_string;
            var costumeSizeNumList = x.filter_by_costume_size_number;
            var itemTypeList = document.getElementsByName("filter_by_item_type");

            if (conditionList != null) {
                for (var i = 0; i < conditionList.length; i++) {
                    if (conditionList[i].checked) {
                        conditionArray.push(conditionList[i].id);
                    }
                }
            }

            if (articleList != null) {
                for (var i = 0; i < articleList.length; i++) {
                    if (articleList[i].checked) {
                        articleArray.push(articleList[i].id);
                    }
                }
            }

            if (costumeSizeStringList != null) {
                for (var i = 0; i < costumeSizeStringList.length; i++) {
                    if (costumeSizeStringList[i].checked) {
                        costumeSizeStringArray.push(costumeSizeStringList[i].id);
                    }
                }
            }

            if (costumeSizeNumList != null) {
                for (var i = 0; i < costumeSizeNumList.length; i++) {
                    if (costumeSizeNumList[i].checked) {
                        costumeSizeNumArray.push(costumeSizeNumList[i].id);
                    }
                }
            }

            if (document.getElementById("groupingExclusive").checked) {
                tagGrouping = "groupingExclusive";
            }

            if (itemTypeList != null) {
                for (var i = 0; i < itemTypeList.length; i++) {
                    if (itemTypeList[i].checked) {
                        itemType = itemTypeList[i].id;
                    }
                }
            }

            localStorage.setItem("ConditionFilter", JSON.stringify(conditionArray));
            localStorage.setItem("ArticleFilter", JSON.stringify(articleArray));
            localStorage.setItem("CostumeSizeStringFilter", JSON.stringify(costumeSizeStringArray));
            localStorage.setItem("CostumeSizeNumFilter", JSON.stringify(costumeSizeNumArray));
            localStorage.setItem("GroupingFilter", tagGrouping);
            localStorage.setItem("ItemTypeFilter", itemType);
            localStorage.setItem("nameFilter", nameText);
            localStorage.setItem("tagFilter", tagText);
        }
      }

      function getCheckboxValues() {
        if (typeof(Storage) !== "undefined") {
            var conditionArray = JSON.parse(localStorage.getItem("ConditionFilter"));
            var articleArray = JSON.parse(localStorage.getItem("ArticleFilter"));
            var costumeSizeStringArray = JSON.parse(localStorage.getItem("CostumeSizeStringFilter"));
            var costumeSizeNumArray = JSON.parse(localStorage.getItem("CostumeSizeNumFilter"));
            var tagGrouping = localStorage.getItem("GroupingFilter");
            var itemType = localStorage.getItem("ItemTypeFilter");
            var nameText = localStorage.getItem("nameFilter");
            var tagText = localStorage.getItem("tagFilter");

            if (conditionArray == null) {
                conditionArray = [];
            }
            if (articleArray == null) {
                articleArray = [];
            }
            if (costumeSizeStringArray == null) {
                costumeSizeStringArray = [];
            }
            if (costumeSizeNumArray == null) {
                costumeSizeNumArray = [];
            }
            if (tagGrouping == null) {
                tagGrouping = "groupingInclusive";
            }

            for (var i = 0; i < conditionArray.length; i++) {
                if (document.getElementById(conditionArray[i]) != null) {
                    document.getElementById(conditionArray[i]).checked = true;
                }
            }

            for (var i = 0; i < articleArray.length; i++) {
                if (document.getElementById(articleArray[i]) != null) {
                    document.getElementById(articleArray[i]).checked = true;
                }
            }

            for (var i = 0; i < costumeSizeStringArray.length; i++) {
                if (document.getElementById(costumeSizeStringArray[i]) != null) {
                    document.getElementById(costumeSizeStringArray[i]).checked = true;
                }
            }

            for (var i = 0; i < costumeSizeNumArray.length; i++) {
                if (document.getElementById(costumeSizeNumArray[i]) != null) {
                    document.getElementById(costumeSizeNumArray[i]).checked = true;
                }
            }

            if (tagGrouping != null) {
                document.getElementById(tagGrouping).checked = true;
            } else {
                document.getElementById("groupingInclusive").checked = true;
            }

            if (itemType != null) {
                document.getElementById(itemType).checked = true;
            } else {
                document.getElementById("typeAll").checked = true;
            }

            document.getElementById("nameBox").value = nameText;
            document.getElementById("tagBox").value = tagText;

            if (itemType == "typeCostume") {
                displayFilterCostumeForm();
            }
        }
      }

      function clearForm() {
          localStorage.setItem("ConditionFilter", JSON.stringify([]));
          localStorage.setItem("ArticleFilter", JSON.stringify([]));
          localStorage.setItem("CostumeSizeStringFilter", JSON.stringify([]));
          localStorage.setItem("CostumeSizeNumFilter", JSON.stringify([]));
          localStorage.setItem("GroupingFilter", "groupingInclusive");
          localStorage.setItem("ItemTypeFilter", "typeAll");
          localStorage.setItem("nameFilter", "");
          localStorage.setItem("tagFilter", "");
          getCheckboxValues();
      }
  </script>


    <title>Prop Box</title>

    <style type="text/css">
      /* Home page-specific CSS */
      #home-pg-container {
        margin: 0 auto;
      }

      #welcome-msg {
        font-size: 2.2em;
        text-align: center;
        width: 100%;
      }

      form {
        border: 0;
        display: inline-block;
        padding: 0 10px;
      }

      form button {
        border: 0;
        background-color: rgb(174,100,211);
        color: #fff;
        font-size: 1.6em;
        margin: 6px 0;
        padding: 0.4em 2em;
        transition: background-color 0.1s ease;
        -webkit-transition: background-color 0.1s ease;
      }

        form button:hover {
          background-color: rgb(203, 156, 227);
        }

      #actions {
        margin: 40px auto;
        text-align: center;
      }
    </style>
</head>

<body>
  <div id="navbar_holder">
  </div>
  <br>
  <div id="home-pg-container">
    <div id="logo" style="margin: auto; width: 50%; text-align: center;">
      <img src="/image/propboxlogo_color.png" alt="Propbox" style="width: 50%;">
    </div>
    <p id="welcome-msg">
    {% if user.permissions != "Standard user" %}
    {{user.name}}, 
    you are currently logged in as a{% if user.permissions == "Trusted user" %} trusted user.{% else %}n admin.{% endif %}</p>
    <div id="actions">
      &nbsp;<form action='/review_edits' method='get'><button type="submit"><i class='fa fa-pencil fa-3x' aria-hidden='true'></i><br>Review edits</button></form>
      {% if user.permissions == "Admin" %}
      <form action="manage_users">
        <button type="submit"><i class='fa fa-user fa-3x' aria-hidden='true'></i><br>Manage users</button>
      </form>
      {% endif %}
      <form action="review_deletions">
        <button type="submit"><i class='fa fa-trash fa-3x' aria-hidden='true'></i><br>Review deletions</button>
      </form>
    </div>
    {% endif %}
  </div>
  <br/><br/>
        <div id="left-pane">
        <!-- View current items -->
        <div>
            {% for item in items %}
                {% if item_name_filter|lower in item.name|lower and not item.deleted and not item.outdated and not item.orphan and not item.is_suggestion%}
                    {% if item_type_filter!="All" %}
                        {% if item.item_type==item_type_filter %}
                            {% for item_condition in item_condition_filter%}
                                {% if item_condition==item.condition%}
                                <div class="item_container">
                                    <h2>{{item.name}}</h2>
                                    {% if item.image %}
                                        <a href="view_image?image_id={{item.key.urlsafe()}}">
                                        <img src="view_image?image_id={{item.key.urlsafe()}}" alt="image of {{item.name}}" class="thumbnail" />
                                        </a>
                                    {% endif %}
                                    <h3>{{item.item_type}}</h3>
                                    <h4>Created by {{item.creator_name}} at {{item.updated.strftime('%I:%M:%S%p %b %d %Y')}}</h4>
                                    <h5><b>Condition</b>: {{item.condition}}</h5>
                                    <p>{{item.description}}</p>
                                    <p>Article:{{item.clothing_article_type}}</p>
                                    <p>Tags:{% for tag in item.tags %} {{tag}},{% endfor %}</p>
                                    <p>(Deleted = {{item.deleted}}, Outdated = {{item.outdated}}, approved = {{item.approved}}, suggested ={{item.is_suggestion}}.)</p>
                                    <form action="/item_details" method="get">
                                      <input type="hidden" name="item_id" value="{{item.key.urlsafe()}}">
                                      <input type="submit" value="Item Details" class="submitButton">
                                    </form>
                                </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% else %}
                        {% for item_condition in item_condition_filter%}
                            {% if item_condition==item.condition%}
                            <div class="item_container">
                                <h2>{{item.name}}</h2>
                                {% if item.image %}
                                    <a href="view_image?image_id={{item.key.urlsafe()}}">
                                    <img src="view_image?image_id={{item.key.urlsafe()}}" alt="image of {{item.name}}" class="thumbnail" />
                                    </a>
                                {% endif %}
                                <h3>{{item.item_type}}</h3>
                                <h4>Created by {{item.creator_name}} at {{item.updated.strftime('%I:%M:%S%p %b %d %Y')}}</h4>
                                <h5><b>Condition</b>: {{item.condition}}</h5>
                                <p>{{item.description}}</p>
                                <p>Article:{{item.clothing_article_type}}</p>
                                <p>Tags:{% for tag in item.tags %} {{tag}},{% endfor %}</p>
                                <p>(Deleted = {{item.deleted}}, Outdated = {{item.outdated}}, approved = {{item.approved}}, suggested ={{item.is_suggestion}}.)</p>
                                <form action="/item_details" method="get">
                                  <input type="hidden" name="item_id" value="{{item.key.urlsafe()}}">
                                  <input type="submit" value="Item Details" class="submitButton">
                                </form>
                            </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div id="right-pane">
        <form style="display: block;" action="/add_item" method="get">
            <input type="submit" value="Add Item" class="submitButton">
        </form>
        <div>
            <!-- Search form -->
            <div class="form">
                <h1> Filter items </h1>
                <form action="/search_and_browse" method="get" onsubmit="setCheckboxValues(this);">
                    <div id="result"></div>
                    <input id="nameBox" name="filter_by_name" type="text" placeholder="name"><br>
                    <h4> Type </h4><br>
                    <input type="radio" id="typeAll" name="filter_by_item_type" value="All" checked="checked" onclick="hideFilterCostumeForm(this); setCheckboxValues('filter_by_item_type', 'typeAll');"> All<br>
                    <input type="radio" id="typeCostume" name="filter_by_item_type" value="Costume" onclick="displayFilterCostumeForm(this);"> Costume<br>
                    <input type="radio" id="typeProp" name="filter_by_item_type" value="Prop" onclick="hideFilterCostumeForm(this); setCheckboxValues('filter_by_item_type', 'typeProp');"> Prop<br>
                    <!-- Alternatively, disabled="disabled" for hiding this section? -->
                    <div id="costume_specific_forms">
                        <h4> Article </h4>
                        <input type="checkbox" id="articleTop" name="filter_by_article" value="Top"> Tops<br>
                        <input type="checkbox" id="articleBottom" name="filter_by_article" value="Bottom"> Bottoms<br>
                        <input type="checkbox" id="articleDress" name="filter_by_article" value="Dress"> Dresses<br>
                        <input type="checkbox" id="articleShoes" name="filter_by_article" value="Shoes"> Shoes<br>
                        <input type="checkbox" id="articleHat" name="filter_by_article" value="Hat"> Hats<br>
                        <input type="checkbox" id="articleCoat" name="filter_by_article" value="Coat/Jacket"> Coats/Jackets<br>
                        <input type="checkbox" id="articleOther" name="filter_by_article" value="Other"> Other<br>
                        <h4> Size </h4>
                        <input type="checkbox" id="sizeStringXXS" name="filter_by_costume_size_string" value="XXS"> XXS<br>
                        <input type="checkbox" id="sizeStringXS" name="filter_by_costume_size_string" value="XS"> XS<br>
                        <input type="checkbox" id="sizeStringS" name="filter_by_costume_size_string" value="S"> S<br>
                        <input type="checkbox" id="sizeStringM" name="filter_by_costume_size_string" value="M"> M<br>
                        <input type="checkbox" id="sizeStringL" name="filter_by_costume_size_string" value="L"> L<br>
                        <input type="checkbox" id="sizeStringXL" name="filter_by_costume_size_string" value="XL"> XL<br>
                        <input type="checkbox" id="sizeStringXXL" name="filter_by_costume_size_string" value="XXL"> XXL<br>
                        <input type="checkbox" id="sizeStringXXXL" name="filter_by_costume_size_string" value="XXXL"> XXXL<br>
                        <br>
                        <input type="checkbox" id="sizeNum0" name="filter_by_costume_size_number" value="0"> 0
                        <input type="checkbox" id="sizeNum1" name="filter_by_costume_size_number" value="1"> 1
                        <input type="checkbox" id="sizeNum2" name="filter_by_costume_size_number" value="2"> 2
                        <input type="checkbox" id="sizeNum3" name="filter_by_costume_size_number" value="3"> 3
                        <input type="checkbox" id="sizeNum4" name="filter_by_costume_size_number" value="4"> 4<br>
                        <input type="checkbox" id="sizeNum5" name="filter_by_costume_size_number" value="5"> 5
                        <input type="checkbox" id="sizeNum6" name="filter_by_costume_size_number" value="6"> 6
                        <input type="checkbox" id="sizeNum7" name="filter_by_costume_size_number" value="7"> 7
                        <input type="checkbox" id="sizeNum8" name="filter_by_costume_size_number" value="8"> 8
                        <input type="checkbox" id="sizeNum9" name="filter_by_costume_size_number" value="9"> 9<br>
                        <input type="checkbox" id="sizeNum10" name="filter_by_costume_size_number" value="10"> 10
                        <input type="checkbox" id="sizeNum11" name="filter_by_costume_size_number" value="11"> 11
                        <input type="checkbox" id="sizeNum12" name="filter_by_costume_size_number" value="12"> 12
                        <input type="checkbox" id="sizeNum13" name="filter_by_costume_size_number" value="13"> 13
                        <input type="checkbox" id="sizeNum14" name="filter_by_costume_size_number" value="14"> 14<br>
                        <input type="checkbox" id="sizeNum15" name="filter_by_costume_size_number" value="15"> 15
                        <input type="checkbox" id="sizeNum16" name="filter_by_costume_size_number" value="16"> 16
                        <input type="checkbox" id="sizeNum17" name="filter_by_costume_size_number" value="17"> 17
                        <input type="checkbox" id="sizeNum18" name="filter_by_costume_size_number" value="18"> 18
                        <input type="checkbox" id="sizeNum19" name="filter_by_costume_size_number" value="19"> 19<br>
                        <input type="checkbox" id="sizeNum20" name="filter_by_costume_size_number" value="20"> 20
                        <input type="checkbox" id="sizeNum21" name="filter_by_costume_size_number" value="21"> 21
                        <input type="checkbox" id="sizeNum22" name="filter_by_costume_size_number" value="22"> 22
                        <input type="checkbox" id="sizeNum23" name="filter_by_costume_size_number" value="23"> 23
                        <input type="checkbox" id="sizeNum24" name="filter_by_costume_size_number" value="24"> 24
                        <input type="checkbox" id="sizeNum25" name="filter_by_costume_size_number" value="25"> 25<br>
                    </div>
                    <h4> Condition </h4><br>
                    <input type="checkbox" id="conditionGood" name="filter_by_condition" value="Good"> Good<br>
                    <input type="checkbox" id="conditionFair" name="filter_by_condition" value="Fair"> Fair<br>
                    <input type="checkbox" id="conditionPoor" name="filter_by_condition" value="Poor"> Poor<br>
                    <input type="checkbox" id="conditionRepair" name="filter_by_condition" value="Being Repaired"> Being Repaired<br>

                    <h4> Tags </h4><br>
                    <textarea id="tagBox" name="filter_by_tags" placeholder="separate tags with enter key"></textarea><br>
                    <input type="radio" id="groupingInclusive" name="filter_by_tag_grouping" value="inclusive" onclick="setCheckedRadioValues(filter_by_tag_grouping, groupingInclusive);"> Has One of Listed<br>
                    <input type="radio" id="groupingExclusive" name="filter_by_tag_grouping" value="exclusive" onclick="setCheckedRadioValues(filter_by_tag_grouping, groupingExclusive);"> Has All of Listed<br>
                    <input type="submit" value="Search" class="submitButton">
                </form>
                <form action="/search_and_browse" method="get" onsubmit="clearForm();">
                    <input type="submit" value="Clear Form" class="submitButton">
                </form>

            </div>
        </div>
    </div>
  <script>
    getCheckboxValues();
  </script>
</body>
</html>
